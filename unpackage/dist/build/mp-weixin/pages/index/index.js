(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{2077:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=(t._self._c,t._f("filterDay")(t.selectTime)),a=t.__map(t.shorttopiclist,function(e,i){var a=t._f("filterTime")(e.startDatetime),n=t._f("filterTime")(e.endDatetime),s=t._f("filternum")(e.correctPercent);return{$orig:t.__get_orig(e),f1:a,f2:n,f3:s}}),n=t._f("filterTimeFormat")(t.startdate,0),s=t._f("filterTimeFormat")(t.enddate,1);t._isMounted||(t.e0=function(e){t.isOpen=!t.isOpen}),t.$mp.data=Object.assign({},{$root:{f0:i,l0:a,f4:n,f5:s}})},n=[];i.d(e,"a",function(){return a}),i.d(e,"b",function(){return n})},"244d":function(t,e,i){"use strict";var a=i("866d"),n=i.n(a);n.a},"5c74":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,n=l(i("5529")),s=i("32ae"),o=l(i("4033")),r=l(i("b324"));function l(t){return t&&t.__esModule?t:{default:t}}function d(t){return h(t)||c(t)||u()}function u(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function c(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function h(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}var f=null;r.default.Util.addEventListener=function(t,e,i){t.addListener(e,i)},r.default.Util.removeEventListener=function(t,e,i){t.removeListener(e,i)},r.default.Util.createEvent=function(t,e){var i=t.type,a=0,n=0,s=t.touches;return s&&s.length>0&&(a=s[0].x,n=s[0].y),{type:i,chart:e,x:a,y:n}};var g=null,p={data:function(){return{cWidth:"",cHeight:"",pixelRatio:1,textarea:"",startdate:null,enddate:null,daylist:[],nowYear:"",nowMonth:"",nowWeek:"",vNowDate:(0,n.default)(),selectTime:"",today:(0,n.default)(),todaytxt:(0,n.default)().format("YYYY-MM-DD"),topiclist:[],userinfo:{},isOpen:!1,shorttopiclist:[],subjectlist:[],subjectCode:null,isChart:!1,opts:{lazyLoad:!0},chartlist:[]}},components:{},onLoad:function(){a=this,this.init()},onPullDownRefresh:function(){this.init(),setTimeout(function(){t.stopPullDownRefresh()},1e3)},mounted:function(){},watch:{selectTime:function(t,e){t!=e&&this.userinfo&&this.userinfo.stuCode&&(this.gettopiclist(),this.getSubjectList())},isOpen:function(t,e){t!=e&&(this.shorttopiclist=t?d(this.topiclist):this.topiclist.slice(0,this.topiclist.length>5?5:this.topiclist.length))}},methods:{init:function(){this.getdaylist(this.vNowDate),this.selectTime=this.vNowDate.format("YYYY-MM-DD"),this.getUserinfo()},prevweek:function(){var t=this.vNowDate.subtract(7,"day");this.getdaylist(t),this.getDatePullList()},nextweek:function(){var e=(0,n.default)(this.daylist[6].allday);if(e.isBefore(this.today)){var i=this.vNowDate.add(7,"day");this.getdaylist(i),this.getDatePullList()}else t.showToast({title:"没有更多数据了！",icon:"none"})},getdaylist:function(t){var e=t;0==e.day()&&(e=e.subtract(7,"day")),this.vNowDate=e,this.daylist=[];for(var i=1;i<=7;i++){var a={allday:e.day(i).format("YYYY-MM-DD"),day:e.day(i).format("D"),isCheck:!1,isdisable:!0};e.day(i).isSame(e)&&(this.selectTime=e.format("YYYY-MM-DD"),a.isCheck=!0),this.daylist.push(a)}e.day(1).isBefore(this.today)?this.startdate=this.daylist[0].allday:this.startdate=this.today.format("YYYY-MM-DD"),e.day(7).isBefore(this.today)?this.enddate=this.daylist[6].allday:this.enddate=this.today.format("YYYY-MM-DD"),this.nowYear=this.vNowDate.year(),this.nowMonth=this.vNowDate.month()+1,this.nowWeek=Math.ceil((this.vNowDate.date()+6-(0==this.vNowDate.day()?7:this.vNowDate.day()))/7)},getDatePullList:function(){var t=this;(0,s.postajax)(s.api.getDatePullList,{stuCode:this.userinfo.stuCode,queryStartTime:this.startdate+" 00:00:00",queryEndTime:this.daylist[this.daylist.length-1].allday+" 23:59:59"}).then(function(e){0==e.code&&e.data&&e.data.length>0&&t.daylist.forEach(function(t){var i=e.data.findIndex(function(e){return e.title==t.allday});i>-1&&(t.isdisable=!1)})})},gettopiclist:function(){var t=this;(0,s.postajax)(s.api.gettopiclist,{stuCode:this.userinfo.stuCode,queryDate:this.selectTime}).then(function(e){0==e.code&&e.data&&(t.topiclist=e.data,t.isOpen?t.shorttopiclist=d(t.topiclist):t.shorttopiclist=t.topiclist.slice(0,t.topiclist.length>5?5:t.topiclist.length))})},advanceProgress:function(){var t=this;(0,s.postajax)(s.api.advanceProgress,{queryStartDate:this.startdate+" 00:00:00",queryEndDate:this.enddate+" 23:59:59",classCode:this.userinfo.classCode,stuCode:this.userinfo.stuCode,subjectCode:this.subjectCode}).then(function(e){if(console.log(e),0==e.code&&e.data){for(var i=e.data.trendTimeLineList,a=(0,n.default)(t.enddate).diff((0,n.default)(t.startdate),"day"),s=[],o=[],r=[],l=[],d=[],u=0;u<=a;u++)l.push({date:(0,n.default)(t.startdate).add(u,"day").format("YYYY-MM-DD"),value:null,type:"综合正确率进步趋势"}),d.push({date:(0,n.default)(t.startdate).add(u,"day").format("YYYY-MM-DD"),value:null,type:"参与率进步趋势"});if(i&&i.length>0)for(u=0;u<i.length;u++){var c=l.findIndex(function(t){return t.date==i[u].date});c>-1&&(l[c].value=parseFloat(i[u].studentCorrectAccuracy.replace(/%/,"")),d[c].value=parseFloat(i[u].studentJoinAccuracy.replace(/%/,"")))}var h=[{data:r,connectNulls:!0,name:"综合正确率进步趋势"},{data:o,name:"参与率进步趋势",connectNulls:!0}];t.getServerData(s,h),t.chartlist=[].concat(l,d)}})},getUserinfo:function(){var e=this;(0,s.postajax)(s.api.getuserinfo).then(function(i){console.log(i),0==i.code&&i.data&&i.data.length>0&&(e.userinfo=i.data[0],t.setStorageSync("stuinfo",i.data[0]),e.gettopiclist(),e.getDatePullList(),e.getSubjectList())})},getSubjectList:function(){var t=this;(0,s.postajax)(s.api.getSubjectList,{queryStartDate:this.startdate+" 00:00:00",queryEndDate:this.enddate+" 23:59:59",classCode:this.userinfo.classCode,stuCode:this.userinfo.stuCode}).then(function(e){t.subjectlist=[],t.subjectCode="",0==e.code&&e.data&&e.data.length>0?(t.subjectlist=e.data,t.subjectCode=t.subjectlist[0].value,t.isChart=!0,t.advanceProgress()):t.isChart=!1})},getServerData:function(t,e){var i={categories:[],series:[]};i.categories=t,i.series=e,this.$mp.page.selectComponent("#column").init(this.initChart)},checkday:function(t){var e=this;this.daylist[t].isdisable||this.daylist.forEach(function(i,a){t==a?(i.isCheck=!0,e.selectTime=i.allday):i.isCheck=!1})},showLineA:function(t,e){f=new o.default({$this:a,canvasId:t,type:"line",fontSize:11,padding:[15,20,0,15],legend:{show:!0,padding:5,lineHeight:11,margin:0},dataLabel:!0,dataPointShape:!0,background:"#FFFFFF",pixelRatio:a.pixelRatio,categories:e.categories,series:e.series,animation:!0,xAxis:{type:"grid",gridColor:"#CCCCCC",gridType:"dash",dashLength:8,boundaryGap:"justify"},yAxis:{gridType:"dash",gridColor:"#CCCCCC",dashLength:8,splitNumber:5,format:function(t){return t.toFixed(0)+"%"},type:"value",max:100,min:0},width:a.cWidth*a.pixelRatio,height:a.cHeight*a.pixelRatio,extra:{line:{type:"curve"}}})},touchLineA:function(t){f.touchLegend(t),f.showToolTip(t,{format:function(t,e){return e+" "+t.name+":"+t.data}})},startDateChange:function(e){if((0,n.default)(e.detail.value).isAfter(this.enddate))return t.showToast({title:"开始时间不能大于结束时间",icon:"none"}),!0;this.startdate=e.detail.value,this.startdate&&this.enddate&&this.getSubjectList()},endDateChange:function(e){if((0,n.default)(e.detail.value).isBefore(this.startdate))return t.showToast({title:"结束时间不能小于开始时间",icon:"none"}),!0;this.enddate=e.detail.value,this.startdate&&this.enddate&&this.getSubjectList()},showDetails:function(e){console.log(e),t.navigateTo({url:"/pages/classdetails/classdetails?info="+encodeURIComponent(JSON.stringify(e))})},change:function(t){console.log(t)},checkSubject:function(t){this.subjectCode=t.value,this.advanceProgress()},initChart:function(t,e,i){return g=new r.default.Chart({el:t,width:e,height:i}),g.source(this.chartlist,{date:{type:"timeCat",tickCount:7,mask:"MM-DD",range:[0,1]},value:{tickCount:5,formatter:function(t){return t+"%"},min:0}}),g.tooltip({showCrosshairs:!0,onShow:function(t){var e=t.items;console.log(e);for(var i=0;i<e.length;i++)e[i].name=i%2==0?"综合正确率":"参与率";3==e.length&&(e[3]=e[1])}}),g.axis("date",{label:function(t,e,i){var a={};return 0===e?a.textAlign="left":e===i-1&&(a.textAlign="right"),a}}),g.line({connectNulls:!0}).color("type").position("date*value").shape("smooth"),g.point().position("date*value").shape("smooth").style({stroke:"#fff",lineWidth:1}),g.legend({position:"bottom",offsetY:-5,align:"center",titleStyle:{fontSize:10}}),g.render(),g}},filters:{filternum:function(t){var e=t||0;return t&&t.length>0&&(e=t.slice(0,t.length-1)),e},filterTime:function(t){var e=t||"";return t&&t.length>0&&(e=t.slice(11,t.length)),e},filterTimeFormat:function(t,e){var i=t||(0==e?"请选择开始时间":"请选择结束时间");return t&&t.length>0&&(i=t.replace(/-/g,".")),i},filterDay:function(t){var e=t||"";return t&&t.length>0?(e=t.split("-"),3==e.length?e[0]+"年"+e[1]+"月"+e[2]+"日":e):e}}};e.default=p}).call(this,i("543d")["default"])},"66ca":function(t,e,i){"use strict";i.r(e);var a=i("2077"),n=i("8d01");for(var s in n)"default"!==s&&function(t){i.d(e,t,function(){return n[t]})}(s);i("244d");var o=i("2877"),r=Object(o["a"])(n["default"],a["a"],a["b"],!1,null,"0a4be86d",null);e["default"]=r.exports},"866d":function(t,e,i){},"8d01":function(t,e,i){"use strict";i.r(e);var a=i("5c74"),n=i.n(a);for(var s in a)"default"!==s&&function(t){i.d(e,t,function(){return a[t]})}(s);e["default"]=n.a}},[["0631","common/runtime","common/vendor"]]]);